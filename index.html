<!DOCTYPE html>
<html>
    <head>
        <style>
            * {
                border: 0;
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font: inherit;
            }

            button {
                padding: 1rem 1.5rem;
                cursor: pointer;
                border-radius: 0.25rem;
            }

            button.primary {
                background-color: red;
                color: white;
            }

            button.secondary {
                background-color: gray;
                color: white;
            }

            .flex {
                display: flex;
            }

            .flex-row {
                flex-direction: column;
            }

            .justify-center {
                justify-content: center;
            }

            .h-screen {
                height: 100vh
            }

            .flex-grow {
                flex: 1
            }

            .flex-wrap {
                flex-wrap: wrap;
            }

            .w-full {
                width: 100%;
            }

            .p-2 {
                padding: 2rem;
            }

            #game-area {
                margin-bottom: 1rem;
                background-color: rgb(255, 192, 74);
                border-radius: 1rem;
            }

            .wasp {
                height: 4rem;
                width: 4rem;
                margin: 1rem;
                background-color: yellow;
                border-radius: 0.25rem;
                position: relative;
            }

            .queen {
                height: 7rem;
                width: 7rem;
            }

            .worker {
                height: 5rem;
                width: 5rem;
            }

            .hit {
                position: absolute;
                width: 100%;
                bottom: 0;
                height: 0;
                border-radius: 0.25rem;
                background-color: red;
            }
        </style>
    </head>
    <body>
        <div class="flex justify-center flex-row h-screen p-2">   
            <div id="game-area" class="flex flex-grow flex-wrap justify-center"></div>

            <div class="flex justify-center">
                <button id="attack" class="primary">Attack</button>

                <button id="reset" class="secondary">Reset</button>
            </div>
        </div>

        <script>
            (function() {
                class WaspGame {
                    constructor(custom = {}) {
                        this.options = Object.assign({
                            onHit: function () {}, // Returns hit wasp object and game object
                            onKill: function () {}, // Returns killed wasp object and game object
                            onGameOver: function () {} // Returns game object
                        }, custom)

                        this.attacks = 0
                        this.play = false
                        this.nest = []
                        this.wasps = [
                            {
                                name: 'queen',
                                hitpoints: 80,
                                damage: 0,
                                hit: 7,
                                total: 1,
                                overOnKill: true
                            },

                            {
                                name: 'worker',
                                hitpoints: 68,
                                damage: 0,
                                hit: 10,
                                total: 5,
                                overOnKill: false
                            },

                            {
                                name: 'drone',
                                hitpoints: 60,
                                damage: 0,
                                hit: 12,
                                total: 8,
                                overOnKill: false
                            }
                        ]

                        this.reset()
                    }

                    buildNest() {
                        this.nest = []

                        for (let i = 0; i < this.wasps.length; i++) {
                            const wasp = this.wasps[i]

                            for (let j = 0; j < wasp.total; j++) {
                                this.nest.push(Object.assign({
                                    id: i + '' + j
                                }, wasp))
                            }
                        }

                        this.play = true
                    }

                    attackRandomWasp() {
                        if (!this.play) {
                            return
                        }

                        this.attacks++

                        const waspIndex = Math.floor(Math.random() * this.nest.length)
                        const wasp = this.nest[waspIndex]
                        wasp.damage = wasp.hit + wasp.damage

                        this.options.onHit(wasp, this)

                        if (wasp.hitpoints <= wasp.damage) {
                            this.nest.splice(waspIndex, 1)

                            this.options.onKill(wasp, this)

                            if (this.nest.length <= 0 || wasp.overOnKill) {
                                this.play = false
                                this.options.onGameOver(this)
                            }
                        }
                    }

                    reset() {
                        this.play = false
                        this.attacks = 0

                        this.buildNest()
                    }
                }

                const game = new WaspGame({
                    onHit: function(wasp, { nest }) {
                        const waspBox = document.getElementById(wasp.id)
                        let hit = waspBox.getElementsByClassName('hit')[0]
                        hit.style.height = `${wasp.damage/wasp.hitpoints * 100}%`
                    }
                })

                function drawWasps() {
                    for (let i = 0; i < game.nest.length; i++) {
                        const wasp = game.nest[i]

                        let item = document.createElement('DIV')
                        item.classList.add('wasp')
                        item.classList.add(wasp.name)
                        item.id = wasp.id

                        let hit = document.createElement('DIV')
                        hit.className = 'hit'
                        item.appendChild(hit)

                        document.getElementById('game-area').appendChild(item)
                    }
                }

                drawWasps()

                document.getElementById('attack').addEventListener('click', function() {
                    game.attackRandomWasp()
                })

                document.getElementById('reset').addEventListener('click', function() {
                    document.getElementById('game-area').innerHTML = ''
                    game.reset()
                    drawWasps()
                })
            })()
        </script>
    </body>
</html>
